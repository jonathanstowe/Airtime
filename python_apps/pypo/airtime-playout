#!/usr/bin/env bash

virtualenv_bin="/usr/local/lib/airtime/airtime_virtualenv/bin/"
. ${virtualenv_bin}activate

# Absolute path to this script
SCRIPT=`realpath $0`
# Absolute directory this script is in
pypo_path=`dirname $SCRIPT`

api_client_path="/usr/local/lib/airtime/"
pypo_script="pypocli.py"
cd ${pypo_path}

set +e


set +e
/usr/bin/locale | grep -i "LANG=.*UTF-\?8" >/dev/null 2>&1
set -e
if [ "$?" != "0" ]; then
    echo "non UTF-8 default locale found ." > /var/log/airtime/media-monitor/error.log
    exit 1
fi

export HOME="/var/tmp/airtime/pypo/"
export PYTHONPATH=${api_client_path}
export LC_ALL=`/usr/bin/locale | grep "LANG=" | cut -d= -f2 | tr -d "\n\""`
export TERM=xterm


#Nothing to do with Pypo, but for container maintenance. Let's parse the IP address
#so we may more easily manage our instance containers
ifconfig eth0 | egrep -o 'inet addr:([0-9]{1,3}\.){3}[0-9]{1,3}' | cut -d':' -f2 > /etc/airtime_ip_addr

exec python ${pypo_path}/${pypo_script} > /var/log/airtime/pypo/py-interpreter.log 2>&1

# EOF
